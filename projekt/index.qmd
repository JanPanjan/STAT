---
author: "Jan Panjan"
title: "Domača naloga - Rdeče vino"
subtitle: "Statistika 2024/25"
date: "21/01/2024"
format:	
  html:
    theme: flatly
    monofont: JetBrains Mono
    toc: true
    toc-fold: true
execute:
  warning: false
---

# Uvod

Kvaliteta vina je odvisna od številnih dejavnikov, od sort grozdja z različnimi lastnostmi, do vinarskih postokov uporabljenih za njegovo predelovanje. Analiza kakovosti vina je pomembna tako za potrošnike, saj jim tako pomaga pri izbiri vina ter pri proizvjalacih, ki lahko na podlagi rezultatov analiz ugotovijo, katere tehnike pridelovanja, sorte grozdja in podobno vpliva na kakovost vina.

V tem poročilu so predstavljene statistične analize podatkov kakovosti rdečega vina. Namen naloge je pripraviti poročilo, ki poda odgovore na vseh 5 zastavljenih vprašanj, ki se osredotočajo na kemijse lastnosti in njihov vpliv na kakovost vina. Uporabljati je bilo potrebno program R. Pri vsakem vprašanju je podan opis problema, opis uporabljenih statističnih metod za analizo problema ter rezultati analize in njihova interpretacija.

# Podatki

## Uporabljeni paketi

Za delo s podatki sem uporabljal paket `tidyverse`, ki je ustvarjen za delo s podatkovnimi okvirji ter `ggplot2` in `gridExtra` za kvalitetne vizualne predstavitve distiliranih podatkov.

```{r}
#| output: false
library(tidyverse)
library(ggplot2)
library(gridExtra)
```

## Branje podatkov

Podatki so shranjeni tako v `csv` kot v `xlsx` obliki. Odločil sem se, da bom uporabil podatke iz `csv` datoteke, saj za branje ni potrebna uporaba dodatnih paketov.

```{r}
df <- "winequality-red.csv" |>
	read.csv(sep = ";") |>
	as_tibble()
```

## Predstavitev podatkov

Podatkovni okvir vsebuje različne kemijske lastnosti vin ter končno oceno kakovosti ocenjevalcev vina. Sestavljen je iz 1599 vrstic z 12 numeričnimi spremenljivkami. 

```{r}
#| cache: true
#| code-fold: true
#| code-summary: manjkajoče vrednosti
map_df(df, \(col){
  is.na(col) |> 
    grep(pattern = "TRUE") |> 
    length()
}) |> 
  pivot_longer(cols = everything(df)) %>% {
    names(.) <- c("spremenljivka", "NA")
    .
  }
```

Podatki so že očiščeni, zato dodatno delo ni potrebno.

```{r}
#| cache: true
#| code-fold: true
#| code-summary: naključni vzorec velikosti 5
df |> slice_sample(n = 5) |> knitr::kable()
```

```{r}
#| cache: true
#| code-fold: true
#| code-summary: povzetek podatkov
sapply(df[names(df)], summary) |> knitr::kable()
```

<br>

Lahko opazimo, da se pojavijo samo ocene med 3 in 8 ter da je povprečna ocena $\approx 5.5$.
Spodaj je opis vseh spremenljivk.

| spremenljivka        | tip       | opis                                  |
|----------------------|-----------|---------------------------------------|
| fixed.acidity        | numerični | kislost vina                          |
| volatile.acidity     | numerični | hlapna kislost vina                   |
| citric.acid          | numerični | vsebnost citronske kisline            |
| residual.sugar       | numerični | vsebnost sladkorja                    |
| chlorides            | numerični | vsebnost kloridov                     |
| free.sulfur.dioxide  | numerični | vsebnost prostega žveplovega dioksida |
| total.sulfur.dioxide | numerični | celotna vsebnost žveplovega dioksida  |
| density              | numerični | gostota vina                          |
| pH                   | numerični | pH nivo vina                          |
| sulphates            | numerični | vsebnost sulfatov                     |
| alcohol              | numerični | odstotek alkohola                     |
| quality              | numerični | ocenjena kvaliteta vina               |

# Naloga 1.

**Grafično prikažite porazdelitev spremenljivk kislost, sladkor ter celoten žveplov dioksid. Grafično prikažite še porazdelitev kvalitete vseh vin. Narišite še histograme, ki prikazujo porazdelitev kislosti glede na kvaliteto vina. Interpretirajte rezultate.**

## Opis problema

V prvi nalogi se osredotočamo na raziskovanje porazdelitve nekaterih kemijskih lastnosti rdečega vina - kislost vina, vsebnost sladkorja ter celotna vsebnost žveplovega dioksida. 
Predstavljene so tudi porazdelitve kvalitet vseh ocenjenih vin, preko česar bomo lahko dobili idejo, kako vplivajo te lastnosti na njihovo kakovost.

## Opis uporabljenih statističnih metod

Porazdelitve podatkov so predstavljene s histogrami. Za boljšo oceno števila intervalov/razredov sem uporabil Sturges pravilo, ki se poenostavi v formulo $k = 1 + \log_2(n)$, kjer je $k$ število intervalov in $n$ skupno število elementov. Znotraj vsakega histograma je prikazana tudi porazdelitev ocen vina znotraj dane spremenljivke.

V pomoč sem si ustvaril funkcijo `quality_histogram`, ki prikaže podano spremenljivko `col` iz podatkovnega okvirja `df` s histogramom. Za število razredov uporabi vrednost `bins_ocena`, izračunano s Sturgesovim pravilom. Kot `fill` parameter vzame `quality_factor`, kjer so vrednosti spremenljivke `quality`.

```{r}
#| cache: true
n <- nrow(df)
bins_ocena <- floor(1 + log2(n))
quality_factor <- factor(df$quality)
```

```{r}
#| code-fold: true
#| code-summary: quality_histogram
quality_histogram <- function(df, col) {
  ggplot(df, aes(x = unlist(select(df, all_of(col))), fill = quality_factor)) +
    geom_histogram(bins = bins_ocena) +
    labs(
      title = paste("Porazdelitev", col, "glede na oceno"),
      x = gsub(pattern = "\\.", replacement = " ", x = col),
      y = "frekvenca",
      fill = "ocena"
    ) +
      scale_fill_brewer(palette = "PuRd") +
      theme_classic()
}
```

Prav tako sem ustvaril tri funckije, s katerimi bom predstavil mere centralne tendence ali mere variabilnosti neke spremenljivke glede na njeno simetrično ali asimetrično porazdelitev.

```{r}
#| code-fold: true
#| code-summary: asim_summary
asim_summary <- function(df, col) {
  selected <- select(df, all_of(col))
  unpacked <- unlist(selected)

  selected |> summarise(
    "min" = min(unpacked),
    "1. kvartil" = quantile(unpacked, 0.25),
    "mediana" = median(unpacked),
    "3. kvartil" = quantile(unpacked, 0.75),
    "IQR" = IQR(unpacked),
    "max" = max(unpacked),
  ) |> 
  knitr::kable()
}
```

```{r}
#| code-fold: true
#| code-summary: sim_summary
sim_summary <- function(df, col) {
  selected <- select(df, all_of(col))
  unpacked <- unlist(selected)

  selected |> summarise(
    "modus" = names(which.max(table(factor(unpacked)))),
    "aritmetična sredina" = mean(unlist(unpacked)),
    "standardni odklon" = sd(unlist(unpacked)),
  ) |> 
    knitr::kable()
}
```

Za vsako spremenljivko sem podal tudi ustrezne mere centralne tendence, primerne za tip porazdelitve (bodisi simetrična ali asimetrična).

## Rezultati in njihova interpretacija

### Porazdelitev ocen vina

```{r}
#| code-fold: true
#| code-summary: graf
ggplot(df, aes(x = quality)) +
  geom_bar() +
  labs(
    title = "Porazdelitev ocen",
    x = "ocena",
    y = "frekvenca"
  ) + 
    theme_classic()
```

Porazdelitev ocen je precej **simetrična**, kar pomeni, da ni (veliko) osamelcev. Zaradi tega je primerno podati *mere centralne tendence* - artimetična sredina, modus in standardni odklon.

```{r}
sim_summary(df, "quality")
```

Najbolj pogosta ocena je 5, razpršenost podatkov pa je tudi precej majhna.

### Kislost vina

Opazno je, da je za spremenljivko `fixed.acidity` (kislost vina) porazdelitev nekoliko asimetrična desno.

```{r}
#| code-fold: true
#| code-summary: graf
quality_histogram(df, "fixed.acidity")
```

Zaradi asimetrične porazdelitve so primerne statistične mere *mere variabilnosti* - mediana, interkvartilni razmik ter prvi in tretji kvartil, saj so bolj robustne in neobčutljive na osamelce, ki so razlog za asimetrične porazdelitve.

```{r}
asim_summary(df, "fixed.acidity")
```

Opazno je, da se z večjo oceno poveča tudi mediana, kar lahko implicira na korelacijo med oceno in kislostjo vina. ***dodaj nek reference kako je kislost pomebna za kakovost vina***.

Iz spodnje tabele je opazno, da je ocene vin precej enakomerno porazdeljene. Višje ocene so malo bolj pogoste, kar lahko pomeni, da so proizvajalci imeli dobro letino. 

```{r}
#| code-fold: true
#| code-summary: povzetek podatkov kislosti vina glede na ocene
select(df, quality, fixed.acidity) |> 
  group_by(quality) |> 
  summarise(
    "1. kvartil" = quantile(fixed.acidity, 0.25),
    "mediana" = median(fixed.acidity),
    "3. kvartil" = quantile(fixed.acidity, 0.75),
    "IQR" = IQR(fixed.acidity)
  ) |> 
  rename(ocena = quality) |> 
  knitr::kable()
```

Visoki IQR vrednosti za oceni 3 in 8 lahko pojasne majhna količina podatkov za ti oceni, 10 in 18 opažanj, kar je malo v primerjavi z ostalimi.

```{r}
quality_factor |> summary()
```

### Vsebnost sladkorja

Porazdelitev vsebnosti sladkorja je zelo asimetrična v desno. Večina vrednosti je med 0 in približno 5. ***To se sklada s podatki ki sem jih dobil na tej speltni strani o tem da mora met vino toliko sladkorja ker to pomeni da je ok al neki, najdi reference***.

```{r}
#| code-fold: true
#| code-summary: graf
quality_histogram(df, "residual.sugar")
```

Tu so predstavljene mere variabilnosti za dano spremenljivko. Iz IQR vrednosti je res razvidno, da je večina podatkov skoncentriranih med 1. in 3. kvartilom, torej med $\approx 2$ in $2.5$.

```{r}
asim_summary(df, "residual.sugar")
```

To lahko pomeni, da višja koncentracija sladkorja v vinu ni pogosta, saj popači njegov okus. Glede na spodnjo tabelo je razvidno, da so ocene ponovno simetrično porazdeljene, vse z mediano približno $2.2$. Velika IQR vrednost za oceno 3 pa je verjetno spet odvisna od majhne količine podatkov z oceno 3.

```{r}
#| code-fold: true
#| code-summary: povzetek podatkov vsebnosti sladkorja v vinu glede na ocene
select(df, quality, residual.sugar) |> 
  group_by(quality) |> 
  summarise(
    "1. kvartil" = quantile(residual.sugar, 0.25),
    "mediana" = median(residual.sugar),
    "3. kvartil" = quantile(residual.sugar, 0.75),
    "IQR" = IQR(residual.sugar)
  ) |> 
  rename(ocena = quality) |> 
  knitr::kable()
```

### Celotna vsebnost žveplovega dioksida

Spremenljivka celotne vsebnosti žveplovega dioksida je prav tako v desno asimetrično porazdeljena.

```{r}
#| code-fold: true
#| code-summary: graf
quality_histogram(df, "total.sulfur.dioxide")
```

Zaradi tega bom predstavil njene mere variabilnosti.

```{r}
asim_summary(df, "total.sulfur.dioxide")
```

Iz njih lahko razberemo, da ima večina vin celotno vsebnost žveplovega dioksida nekje med 22 in 62. Žal nimam enot, a lahko trdim, da to v primerjavi z največje izmerjeno vsebnostjo 289 ni precej velika vrednost.

To lahko pomeni, da so vina s manjšo vsebnostjo žveplovega dioksida bolj razširjena ali pa imajo vina s manjšo vsebnostjo boljši okus in so zato bolj pogosta.

```{r}
#| code-fold: true
#| code-summary: povzetek podatkov celotne vsebnosti žveplovega dioksida v vinu glede na ocene
select(df, quality, total.sulfur.dioxide) |> 
  group_by(quality) |> 
  summarise(
    "1. kvartil" = quantile(total.sulfur.dioxide, 0.25),
    "mediana" = median(total.sulfur.dioxide),
    "3. kvartil" = quantile(total.sulfur.dioxide, 0.75),
    "IQR" = IQR(total.sulfur.dioxide)
  ) |> 
  rename(ocena = quality) |> 
  knitr::kable()
```

Ocene so ponovno precej enakomerno porazdeljene glede na vrednosti spremenljivke. Malo več jih je skoncentriranih okoli srednjih vrednosti za oceno, 5 in 6, kar je razvidno iz mediane in IQR.

***Morda so ugotovili optimalno vsebovanost žveplovega dioksida***

# Naloga 2.

**Izpišite kvartile in standardni odklon za spremenljivko “kislost” ter narišite okvir z ročaji. Enako naredite še za spremenljivki “sladkor” in “celoten žveplov dioksid”. Interpetirajte rezultate.**

# Naloga 3.

**Zanima nas, ali je povprečna kislost vin, ki so dobila oceno 5, višja kot povprečne kislosti vin z oceno 6. Katerega od statističnih testov bi uporabili in kakšen je vaš zaključek? Z ustreznim statističnim testom preverite še hipotezo, da je povprečna vsebnost sladkorja vseh izbranih vin večja od 2,3. Interpretirajte rezultate.**

# Naloga 4.

**Za vsako od dvanajstih zgoraj omenjenih spremenljivk preverite, ali so podatki skladni z normalno porazdelitvijo. Če da, podajte parametre teh porazdelitev.**

# Naloga 5.

**Po lastni izbiri postavite vsaj še eno raziskovalno vprašanje in nanj natančno odgovorite.**